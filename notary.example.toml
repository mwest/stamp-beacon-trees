# Example SBT Notary Configuration
# Copy this to notary.toml and customize for your deployment

[server]
# Network interface to bind to
# Use "0.0.0.0" to listen on all interfaces
# Use "127.0.0.1" for local-only access
host = "127.0.0.1"

# Port to listen on
port = 8080

# Maximum concurrent connections
max_connections = 1000

[hsm]
# Path to PKCS#11 library
# SoftHSM (development): "/usr/lib/softhsm/libsofthsm2.so"
# YubiHSM: "/usr/lib/x86_64-linux-gnu/pkcs11/yubihsm_pkcs11.so"
# AWS CloudHSM: "/opt/cloudhsm/lib/libcloudhsm_pkcs11.so"
pkcs11_library = "/usr/lib/softhsm/libsofthsm2.so"

# HSM slot ID
# Use pkcs11-tool --list-slots to find available slots
slot_id = 0

# Key label in HSM
# The Ed25519 signing key must already exist with this label
key_label = "sbt-notary-key"

# Optional: Key ID (alternative to label)
# key_id = [0x01, 0x02, 0x03]

# NOTE: HSM PIN should be provided via environment variable:
# export SBT_HSM_PIN="your-pin-here"

[batch]
# Maximum number of requests in a single batch
# Larger batches = more efficient, but higher latency
max_batch_size = 1000

# Maximum time to wait before processing a batch (milliseconds)
# Ensures requests don't wait too long even if batch isn't full
max_wait_ms = 100

# Target interval for processing batches (milliseconds)
# This determines the timestamp granularity
# 1000ms = 1 second between tree builds
batch_interval_ms = 1000

# TLS Configuration (optional - omit this section to disable TLS)
# WARNING: Running without TLS is insecure for production use!
#
# [tls]
# # Path to server certificate file (PEM format)
# cert_path = "/etc/sbt/server.crt"
#
# # Path to server private key file (PEM format)
# key_path = "/etc/sbt/server.key"
#
# # Path to CA certificate for client verification (optional, enables mTLS)
# # If set, clients must present valid certificates signed by this CA
# # ca_cert_path = "/etc/sbt/ca.crt"
#
# # Require client certificates (mTLS) - only applies if ca_cert_path is set
# # require_client_cert = true

# Rate Limiting Configuration (optional - omit this section to disable rate limiting)
# Protects the server from DoS attacks using token bucket algorithm
#
# [rate_limit]
# # Enable rate limiting (default: true when section is present)
# enabled = true
#
# # Maximum requests per second per client IP
# per_ip_rps = 100
#
# # Maximum burst size per client IP (token bucket capacity)
# # Allows short bursts above the per-second rate
# per_ip_burst = 200
#
# # Maximum global requests per second (across all clients)
# global_rps = 10000
#
# # Maximum global burst size
# global_burst = 20000
#
# # Maximum request body size in bytes (default: 1KB for a digest)
# # Requests exceeding this size are rejected
# max_request_size = 1024
#
# # Cleanup interval for expired rate limit entries (seconds)
# # How often to purge inactive client tracking entries
# cleanup_interval_secs = 60
#
# # Time-to-live for client rate limit entries (seconds)
# # Entries not seen within this period are removed
# entry_ttl_secs = 300

# Authentication Configuration (optional - omit this section to disable authentication)
# Supports API key authentication and mTLS client certificates
#
# [auth]
# # Enable authentication (default: true when section is present)
# enabled = true
#
# # Authentication mode:
# # - "api_key": Require API key in x-api-key header (default)
# # - "mtls_only": Require mTLS client certificate (TLS must be configured with ca_cert_path)
# # - "hybrid": Accept either API key or mTLS certificate
# mode = "api_key"
#
# # Allow anonymous access to health and public key endpoints
# # (recommended to leave true for monitoring)
# allow_anonymous_health = true
#
# # Allow anonymous access to timestamp endpoint
# # (not recommended - use with rate limiting only)
# allow_anonymous_timestamp = false
#
# # API keys can be configured inline, from a file, or from environment variable
#
# # Inline API keys (not recommended for production - use file or env var)
# # [[auth.api_keys]]
# # key_id = "client-1"
# # secret = "your-secret-key-here"
# # description = "Main client application"
# # enabled = true
#
# # Load API keys from a file (one per line, format: "key_id:secret" or just "secret")
# # api_keys_file = "/etc/sbt/api_keys.txt"
#
# # API keys can also be loaded from environment variable:
# # export SBT_API_KEYS="key1:secret1,key2:secret2"
